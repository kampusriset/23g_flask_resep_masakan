{% extends 'base.html' %} {% block header %}
<h2>{% block title %} Profil Saya {% endblock title %}</h2>
{% endblock header %} {% block content %}

<!-- Profil -->
<div class="bg-amber-50 container mx-auto px-4 py-8 mt-10 space-y-8">
  <!-- Section 1: Resep Favorit -->
  <section id="favorite-recipes" class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold text-gray-800" data-aos="fade-down" data-aos-duration="1000" data-aos-delay="200">Resep Favorit Anda</h2>
    <div class="relative max-w-6xl mx-auto py-6">
      <!-- Tombol Panah Kiri -->
      <button id="prevBtn" class="absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-gray-200 p-2 rounded-full shadow-md hover:bg-gray-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <!-- Container Cards -->
      <div id="cardWrapper" class="w-full overflow-hidden">
        <div id="cardContainer" 
     class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for resep in resep_favorit %}
          <!-- Card 1 -->
          <div class="max-w-sm bg-white border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700" data-aos="flip-right" data-aos-duration="1000" data-aos-delay="200">
            <!-- Gambar Makanan -->

            <img class="rounded-t-lg w-full h-48 object-cover" src="{{ url_for('static', filename='uploads/' + resep.gambar.split('/')[-1]) }}" alt="{{ resep.nama_resep }}" />

            <div class="p-5">
              <!-- Judul Makanan -->
              <h5 class="mb-2 text-lg font-bold tracking-tight text-gray-900 dark:text-white">{{ resep.nama_resep }}</h5>

              <!-- Informasi Jumlah Likes, Oleh Siapa -->
              <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-3">
                <span>Oleh: {{ resep.pembuat.nama if resep.pembuat else 'Anonim' }}</span>
              </div>

              <!-- Waktu Masak -->
              <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6h4" />
                  <circle cx="12" cy="12" r="10" />
                </svg>
                <span>Waktu Masak: {{ resep.waktu_masak }} Menit</span>
              </div>

              <!-- Tombol -->
              <div class="flex items-center justify-between">
                <!-- Tombol Detail -->
                <a
                  href="{{ url_for('details', jenis='resep', id=resep.id) }}"
                  class="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-800"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor" class="mr-2">
                    <path
                      d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z"
                    />
                  </svg>
                  Detail
                </a>

                <!-- Tombol Favorit -->
                <button
                  class="flex items-center px-4 py-2 text-sm font-medium text-white bg-red-500 border border-red-500 rounded-lg hover:bg-red-400 focus:ring-4 focus:outline-none focus:ring-red-400 hapus-favorit-btn"
                  data-resep-id="{{ resep.id }}"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                  </svg>
                  Hapus Favorit
                </button>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Tombol Panah Kanan -->
      <button id="nextBtn" class="absolute right-0 top-1/2 transform -translate-y-1/2 z-10 bg-gray-200 p-2 rounded-full shadow-md hover:bg-gray-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </section>

  <!-- Section 2: Resep yang Dibuat -->
  <section id="my-recipes" class="bg-white p-6 rounded-lg shadow-md">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold text-gray-800" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="200">Resep Anda</h2>
      <button id="create-recipe-btn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Buat Resep</button>
    </div>

    <!-- Form Pembuatan Resep -->
    <div id="create-recipe-form" class="hidden bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Buat Resep Baru</h2>
      <form method="POST" action="{{ url_for('tambahResep') }}" enctype="multipart/form-data" class="space-y-4">
        <!-- Nama Resep -->
        <div>
          <label for="nama_resep" class="block text-sm font-medium text-gray-700">Nama Resep</label>
          <input type="text" name="nama_resep" id="nama_resep" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Masukkan nama resep" required />
        </div>

        <!-- Unggah Gambar -->
        <div>
          <label for="gambar" class="block text-sm font-medium text-gray-700">Unggah Gambar</label>
          <input type="file" name="gambar" id="gambar" class="w-full p-2 border border-gray-300 rounded-lg" accept="image/*" required />
        </div>

        <!-- Waktu Masak -->
        <div>
          <label for="waktu_masak" class="block text-sm font-medium text-gray-700">Waktu Masak (menit)</label>
          <input type="number" name="waktu_masak" id="waktu_masak" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Masukkan waktu masak" required />
        </div>

        <!-- Kategori -->
        <div>
          <label for="kategori_id" class="block text-sm font-medium text-gray-700">Kategori</label>
          <select name="kategori_id" id="kategori_id" class="w-full p-2 border border-gray-300 rounded-lg" required>
            <option value="" disabled selected>Pilih kategori</option>
            {% for kategori in kategoris %}
            <option value="{{ kategori.id }}">{{ kategori.nama_kategori }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Deskripsi Singkat -->
        <div>
          <label for="deskripsi_singkat" class="block text-sm font-medium text-gray-700">Deskripsi Singkat</label>
          <textarea name="deskripsi_singkat" id="deskripsi_singkat" class="w-full p-2 border border-gray-300 rounded-lg" rows="3" placeholder="Masukkan deskripsi singkat" required></textarea>
        </div>

        <!-- Alat dan Bahan -->
        <div>
          <label for="alat_dan_bahan" class="block text-sm font-medium text-gray-700">Alat dan Bahan</label>
          <textarea name="alat_dan_bahan" id="alat_dan_bahan" class="w-full p-2 border border-gray-300 rounded-lg" rows="4" placeholder="Masukkan alat dan bahan" required></textarea>
        </div>

        <!-- Langkah-Langkah -->
        <div>
          <label for="langkah_langkah" class="block text-sm font-medium text-gray-700">Langkah-Langkah</label>
          <textarea name="langkah_langkah" id="langkah_langkah" class="w-full p-2 border border-gray-300 rounded-lg" rows="6" placeholder="Masukkan langkah-langkah" required></textarea>
        </div>

        <!-- Tombol Simpan -->
        <div class="flex space-x-4">
          <button type="submit" class="px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700">Tambah Resep</button>
          <button type="button" id="cancel-btn" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">Batal</button>
        </div>
      </form>
    </div>

    <!-- Form Edit Resep -->

    <!-- Daftar Resep -->
    <div class="relative max-w-4xl mx-auto py-6">
      <!-- Container Cards -->
      <div id="cardWrapper" class="w-full overflow-hidden">
        <div id="cardContainer" 
     class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for resep in reseps %}
          <!-- Card 1 -->
          <div class="max-w-sm bg-white border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700" data-aos="flip-left" data-aos-duration="1000" data-aos-delay="200">
            <!-- Gambar Makanan -->

            <img class="rounded-t-lg w-full h-48 object-cover" src="{{ url_for('static', filename='uploads/' + resep.gambar.split('/')[-1]) }}" alt="{{ resep.nama_resep }}" />

            <div class="p-5">
              <!-- Judul Makanan -->
              <h5 class="mb-2 text-lg font-bold tracking-tight text-gray-900 dark:text-white">{{ resep.nama_resep }}</h5>

              <!-- Informasi Jumlah Likes, Oleh Siapa -->
              <!-- <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
                <span>1.2k Likes</span>
              </div> -->

              <!-- Waktu Masak -->
              <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6h4" />
                  <circle cx="12" cy="12" r="10" />
                </svg>
                <span>Waktu Masak: {{ resep.waktu_masak }} Menit</span>
              </div>

              <!-- Tombol -->
            <!-- Tombol Aksi -->
<div class="space-y-3">

  <!-- Tombol Detail (1 baris penuh) -->
  <a
    href="{{ url_for('details', jenis='resep', id=resep.id) }}"
    class="flex items-center justify-center px-4 py-2 text-sm font-medium 
           text-white bg-blue-600 rounded-lg hover:bg-blue-700 w-full m-2">
    <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" 
         fill="currentColor" class="mr-2">
      <path d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Z"/>
    </svg>
    Detail
  </a>

  <!-- Tombol Edit + Hapus (berjejer) -->
  <div class="flex
justify-center
items-center gap-2  w-full">

    <!-- Tombol Edit -->
    <button
      type="button"
      onclick="openModal(
        '{{ resep.id }}',
        '{{ resep.nama_resep }}',
        '{{ resep.waktu_masak }}',
        '{{ resep.kategori_id }}',
        `{{ resep.deskripsi_singkat | replace('\n', '\\n') }}`,
        `{{ resep.alat_dan_bahan | replace('\n', '\\n') }}`,
        `{{ resep.langkah_langkah | replace('\n', '\\n') }}`
      )"
      class="flex items-center justify-center px-4 py-2 text-sm font-medium 
             text-yellow-600 bg-white border border-yellow-500 rounded-lg 
             hover:bg-yellow-100 w-1/2">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" 
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M18.5 2.5L21.5 5.5L12 15L9 15L9 12L18.5 2.5Z" />
      </svg>
      Edit
    </button>

    <!-- Tombol Hapus -->
    <form method="POST"
          action="{{ url_for('hapusResep', id=resep.id) }}"
          onsubmit="return confirm('Apakah Anda yakin ingin menghapus resep ini?')"
          class="w-1/2">
      <button
        type="submit"
        class="flex items-center justify-center px-4 py-2 text-sm font-medium 
               text-red-600 bg-white border border-red-500 rounded-lg 
               hover:bg-red-100 w-full">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2"
             fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M6 18L18 6M6 6l12 12" />
        </svg>
        Hapus
      </button>
    </form>

  </div>

</div>

            </div>
          </div>
          {% endfor %}
         
          
        </div>
      </div>
    </div>
<!-- MODAL EDIT FINAL -->
<div id="modalEdit" class="fixed inset-0 z-50 hidden">

  <!-- BACKDROP -->
  <div id="modalBackdrop"
       class="absolute inset-0 bg-black/40 opacity-0 transition duration-300"></div>

  <!-- CENTER WRAPPER -->
  <div class="relative w-full max-w-3xl mx-auto flex items-center min-h-screen px-4">

    <!-- MODAL BOX -->
    <div id="modalContent"
      class="bg-white rounded-xl shadow-xl w-full max-h-[90vh]
             opacity-0 scale-95 translate-y-6
             transition-all duration-300 flex flex-col">

      <!-- HEADER -->
      <div class="flex justify-between items-center px-6 py-4 border-b">
        <h2 class="text-xl font-bold text-gray-800">Edit Resep</h2>

              <!-- FOOTER BUTTONS (sticky) -->
      <div class="flex justify-end gap-3 px-6 py-4 border-t bg-white sticky bottom-0">
        <button type="button" onclick="closeModal()"
          class="px-4 py-2 mx-3 rounded-lg bg-gray-200 hover:bg-gray-300">Batal</button>

        <button type="submit" form="editForm"
          class="px-4 py-2 mx-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700">Simpan</button>
      </div>

        <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-xl">âœ•</button>
      </div>

      <!-- BODY (scrollable) -->
      <div class="p-6 space-y-4 overflow-y-auto">
        
        <form id="editForm" method="POST" enctype="multipart/form-data" class="space-y-4">

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-medium text-gray-700">Nama Resep</label>
              <input id="edit_nama_resep" name="nama_resep"
                class="w-full p-2 border rounded-lg bg-white"/>
            </div>

            <div>
              <label class="font-medium text-gray-700">Waktu Masak (menit)</label>
              <input id="edit_waktu_masak" name="waktu_masak" type="number"
                class="w-full p-2 border rounded-lg bg-white"/>
            </div>
          </div>

          <div>
            <label class="font-medium text-gray-700">Kategori</label>
            <input id="edit_kategori_id" name="kategori_id"
              class="w-full p-2 border rounded-lg bg-white" />
          </div>

          <div>
            <label class="font-medium text-gray-700">Deskripsi Singkat</label>
            <textarea id="edit_deskripsi_singkat" name="deskripsi_singkat" 
              rows="2" class="w-full p-2 border rounded-lg bg-white"></textarea>
          </div>

          <div>
            <label class="font-medium text-gray-700">Alat & Bahan</label>
            <textarea id="edit_alat_dan_bahan" name="alat_dan_bahan" 
              rows="3" class="w-full p-2 border rounded-lg bg-white"></textarea>
          </div>

          <div>
            <label class="font-medium text-gray-700">Langkah-Langkah</label>
            <textarea id="edit_langkah_langkah" name="langkah_langkah" 
              rows="3" class="w-full p-2 border rounded-lg bg-white"></textarea>
          </div>

          <div>
            <label class="font-medium text-gray-700">Ganti Gambar (opsional)</label>
            <input type="file" name="gambar"
              class="w-full p-2 border rounded-lg bg-white"/>
          </div>

        </form>

      </div>


    </div>
  </div>
</div>


  </section>
</div>

<script>
  const createRecipeBtn = document.getElementById("create-recipe-btn");
  const createRecipeForm = document.getElementById("create-recipe-form");
  const cancelBtn = document.getElementById("cancel-btn");

  // Tampilkan form saat tombol "Buat Resep" ditekan
  createRecipeBtn.addEventListener("click", () => {
    createRecipeForm.classList.remove("hidden");
  });

  // Sembunyikan form saat tombol "Batal" ditekan
  cancelBtn.addEventListener("click", () => {
    createRecipeForm.classList.add("hidden");
  });


function openModal(id, nama='', waktu='', kategori='', deskripsi='', bahan='', langkah='') {
  const w = document.getElementById("modalEdit");
  const b = document.getElementById("modalBackdrop");
  const c = document.getElementById("modalContent");

  // Inject data
  document.getElementById("edit_nama_resep").value = nama;
  document.getElementById("edit_waktu_masak").value = waktu;
  document.getElementById("edit_kategori_id").value = kategori;
  document.getElementById("edit_deskripsi_singkat").value = deskripsi;
  document.getElementById("edit_alat_dan_bahan").value = bahan;
  document.getElementById("edit_langkah_langkah").value = langkah;

document.getElementById('editForm').action = "/profil/update/" + id;


  w.classList.remove("hidden");

  setTimeout(() => {
    b.classList.add("opacity-100");
    c.classList.add("opacity-100", "scale-100", "translate-y-0");
  }, 10);
}

function closeModal() {
  const w = document.getElementById("modalEdit");
  const b = document.getElementById("modalBackdrop");
  const c = document.getElementById("modalContent");

  b.classList.remove("opacity-100");
  c.classList.remove("opacity-100", "scale-100", "translate-y-0");

  setTimeout(() => {
    w.classList.add("hidden");
  }, 300);
}

// klik area luar = close
// Tutup modal hanya jika klik backdrop, bukan klik di dalam modal
document.getElementById("modalEdit").addEventListener("click", (e) => {
  const content = document.getElementById("modalContent");

  // jika klik tepat pada backdrop (wrapper), bukan konten
  if (e.target === e.currentTarget) {
    closeModal();
  }
});

</script>

{% endblock content %}
